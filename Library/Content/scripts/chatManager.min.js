function handleBrowserState(n){browserState=n}function SetBlueToChatButton(n){console.log(n);$(n).val().length===0?($(n).removeClass("wrote"),$(n).siblings().find(".fa").removeClass("blue-arrow")):($(n).addClass("wrote"),$(n).siblings().find(".fa").addClass("blue-arrow"))}function GetTimeFromDateTime(n){var t=new Date(n);return("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}function FinishedConversations(){var r;if(console.log("started FinishedConversations"),console.log(finishedConversationQueue),finishedConversationQueue.length>0){newFinishedConversation=!0;console.log("finish converastion");var t=finishedConversationQueue[0],n=t.conversation,i=t.candidate,u=t.user;RemoveUserChattingList(n.CandidateID);r="private_"+n.CandidateID;$("#"+r).length>0&&RemoveChatContent();n.Status==2?($("#EndConversationModal .modal-title").empty().append(i.UserName+Res.Others.CandidateRateYourEndingChat),$("#EndConversationModal").data("id",i.UserID),$("#EndConversationModal").data("cstatus",n.Status),$("#EndConversationModal").modal()):n.Status==3||($("#EndConversationModal .modal-title").empty().append(Res.EndConversationModal.ForChatTimeEnded+i.UserName+Res.EndConversationModal.ForChatTimeEnded2),$("#EndConversationModal").data("cstatus",n.Status),$("#EndConversationModal").data("id",i.UserID),$("#EndConversationModal").modal());finishedConversationQueue.splice($.inArray(t,finishedConversationQueue),1)}}function GetProfilePhotoFromUserList(n){var t="";return $("#"+n).length>0?t=$("#"+n).find(".user-photo").attr("src"):$.ajax({async:!1,url:"/Company/OnlineCareerDay/GetProfilePhoto",type:"GET",data:{userId:n},success:function(n){t=n},error:function(n){console.log(n.responseText+" - "+n.status)}}),t}function SetActive(n){n}function DeleteInterval(n){console.log("DeleteInterval:"+n);$.each(timeintervals,function(t,i){if(i.userId==n)return timeintervals.splice(t,1),!1})}function EndConversation(n,t,i){var f,e,o,s,r,u;if(console.log("start function EndConversation"),console.log(n),chat.server.CompanyEndConversation(n),console.log("chattingUserID:"+t),f="private_"+t,e=!1,$("#"+f).length>0&&(console.log("a21"),console.log(f),e=!0),$("#"+t).length>0){if(console.log("a22"),console.log(t),$("#"+t).addClass("endeduser"),o="time"+t,$("#"+o).hide(),console.log("expired22"),console.log(i),i&&(s="expired_"+t,$("#"+s).show()),console.log("timeintervals"),console.log(timeintervals),timeintervals.length>0)for(r=timeintervals.filter(function(n){return n.userId==t}),console.log("timeinterval"),console.log(r),u=0;u<r.length;u++)clearInterval(r[u].timeObject),DeleteInterval(r[u].userId);e&&$("#"+t).trigger("click")}}function SendMessage(n){var t,r,i;return(console.log("sendMessage"),t=$(n).data("userid"),r=$(".submit"),console.log("userId:"+t),i=$(".message-input input").val(),$.trim(i)=="")?!1:(chat.server.SendPrivateMessage(t,i),$(".message-input .wrap input").val(""),$(".message-input .wrap input").focus(),!1)}function UpdateWaitingUserCount(){var n=$("#bekleyen ul li").length;$(".waitingTotalCandidateCount").html(n);n>0?$("#bekleyen").removeClass("shownotalent"):$("#bekleyen").addClass("shownotalent")}function UpdateChattingUserCount(){var n=$("#gorusulen ul li").length;$(".chattingTotalCandidateCount").html(n);n>0?$("#gorusulen").removeClass("shownotalent"):$("#gorusulen").addClass("shownotalent")}function RemoveUserFromWaitingList(n){n!=0&&$("#bekleyen ul li").each(function(){var t=$(this);t.prop("id")==n&&(console.log("removed"),t.remove())});UpdateWaitingUserCount()}function RemoveUserChattingList(n){$("#gorusulen ul li").each(function(){var t=$(this);t.prop("id")==n&&(console.log("removed"),t.remove())});UpdateChattingUserCount()}function registerClientMethods(n){n.client.onConnected=function(t,r,u,f,e,o){var s;for(console.log("Event: onConnected"),$("#hdId").val(t),$("#hdUserName").val(r),console.log("allWaitingUsers"),$("#profile span.contact-status").addClass("online"),f.length>0?(waitingUserCount=f.length,console.log($(".waitingTotalCandidateCount")),$(".waitingTotalCandidateCount").html(f.length)):$(".waitingTotalCandidateCount").html(0),u.length>0&&(chattingUserCount=u.length),s=u[u.length-1],i=0;i<u.length;i++)console.log("idd"),console.log(u[i]),AddUser(n,u[i].UserID,u[i].UserName,u[i].UserID,u[i].UniName,u[i].UniProgram,u[i].UniClass,u[i].ProfilePhoto,u[i].Level,u[i].Conversastion,s.UserID==u[i].UserID,u[i].CandidateOnline);$.each(f,function(n,t){AddWaitingUser(t.UserID,t.UserName,o,t.UniName,t.UniProgram,t.UniClass,t.ProfilePhoto,t.Level)})}}function GetWaitingUsers(){var n=parseInt($("[id$=hdnCurrentUserID]").val());chat.server.GetWaitingUsers(n).then(function(n){console.log(n);$.each(n,function(n,t){AddWaitingUser(t.UserID,t.UserName,t.UserID,t.UniName,t.UniProgram,t.UniClass,t.ProfilePhoto,t.Level)})})}function OpenPrivateChatWindow(n,t,i,r,u){var f;chattingUserID=t;f="private_"+t;createPrivateChatWindow(n,t,f,i,i,r,u)}function CheckProfilePhoto(n,t,i){var r,f;if(n==""){r="";$.each(profilePhotos,function(n,t){if(t.userId==i)return r=t.photo,!1});var u="";return u=(Math.random()*16777215<<0).toString(16),console.log(),r==""&&(r="https://dummyimage.com/100x100/"+u+"/fff&text="+t.charAt(0),f={userId:i,photo:r},profilePhotos.push(f)),r}return n}function CandidateSaw(){var r=$("#notes").val(),n,t,i;console.log(r);n=$("input[name='rate']:checked").val();t=0;n&&(t=n);console.log(n);const u=new URLSearchParams(window.location.search);i=u.get("c");$.ajax({url:"/OnlineCareerFair/UpdateModeratorSawConverationWasEnded",type:"POST",data:{conversationId:i},success:function(){},error:function(n){console.log(n.responseText+" - "+n.status)}}).done(function(){setTimeout(function(){var n=$("#hdnRedirectUrlForOnlineCompaniesPage").val();document.location.href=n},500)})}function ShowFinishedConversationWindow(n,t,i,r,u,f,e){var o="",s="";$("#"+t).length!=0&&(o=$("#"+t).find(".info .title").text(),s=$("#"+t).find(".info .candidate-uni").text());$("#mesgs").removeClass("chat-bg");var h='<div class="contact-profile"> <ul> <li > <div class="row"> <div class="col-md-7 col-6 d-flex px-0 px-md-3"> <div class="col-md-3 col-4 justify-content-center align-self-center" style="max-width:100px;"> <img class="dot" src="'+e+'"> <span class="contact-status online" style="top:0;margin:45px 0 0 55px;"><\/span> <\/div><div class="col-md-8 col-8 align-self-center px-0" style="padding:0;"> <h5 class="companyusername mb-1 ml-2">'+r+'<\/h5> <h5 class="companyusertitle mb-1 ml-2">'+o+'<\/h5> <h5 class="candidate-uni mb-1 ml-2">'+s+'<\/h5> <\/div><\/div><div class="col-md-5 col-6 d-flex justify-content-end align-self-end"> <div class="col-md-12 col-12 d-flex flex-column justify-content-center"> <\/div><\/div><\/div><div class="row"> <div class="col-md-12 "> <div class="candidateinfo" style=""> <\/div><div class="row showcandidateinfo d-flex justify-content-center flex-column align-items-center"> <div class="rectangle"><\/div><div class="rectangle2"><\/div><\/div><\/div><\/li><\/ul> <\/div>',c=' <div class="endedConverastion"> <div class="col-md-12 d-flex justify-content-center mb-3"><span class="congratulations-icon">ðŸŽ‰<\/span> <\/div><div class="col-md-12 d-flex flex-column align-items-center"> <span class="congratulations-text mb-2">'+Res.EndConversationModal.Congrats+'<\/span> <span class="congratulations-stext">'+Res.EndConversationModal.CompletedToChat+'<\/span> <\/div><div class="col-md-12 hr my-md-5 my-4"><\/div><div class="col-md-12 d-flex flex-column "> <div> <h4 class="nasil-ilerlemek-istersin">'+Res.EndConversationModal.Title+'<\/h4> <\/div><div> <div> <div class="radio"> <label> <input class="hicbir-sey-yapma" id="r1" type="radio" name="Action" value="1" checked>'+Res.EndConversationModal.Options.DoNothing+" <span>"+Res.EndConversationModal.Options.DoNothingSpan+'<\/span><\/label> <\/div><div class="radio"> <label> <input class="hicbir-sey-yapma" id="r2" type="radio" name="Action" value="2">'+Res.EndConversationModal.Options.AddToptalens+"<span>"+Res.EndConversationModal.Options.AddToptalensSpan+'<\/span><\/label> <\/div><div class="radio"> <label> <input class="hicbir-sey-yapma" id="r3" type="radio" name="Action" value="3">'+Res.EndConversationModal.Options.Block+" <span>"+Res.EndConversationModal.Options.BlockSpan+'<\/span><\/label> <\/div><\/div><div class="col-md-12 conversation-notes mt-3 mb-2 px-0"> <textarea class="col-md-12" name="note" id="note" maxlength="1500" placeholder="'+Res.EndConversationModal.WriteNotes+'"><\/textarea> <\/div><div class="col-md-12 d-flex justify-content-end"> <a href="javascript:void(0)" onclick="FinishConversation(\''+f.ID+"',"+t+')" class="btn-saveandreturnfair">'+Res.EndConversationModal.SaveAndContinue+'<i class="btn-arrow"><\/i><\/a> <\/div><\/div><\/div>',l=$('<div class="msg_history" id='+i+">"+h+c+"<\/div>");$("#mesgs").append(l);console.log(f)}function createPrivateChatWindow(n,t,i,r,u,f,e){var o,c,l,a,i,w,b;if(console.log(f),console.log("invoked createPrivateChatWindow"),$("#mesgs").html(""),$("#mesgs").removeClass("chat-bg"),o="",o=GetProfilePhotoFromUserList(t),f&&f.Status!=0&&f.ModeratorSaw==!1)console.log("this conversation finished"),ShowFinishedConversationWindow(n,t,i,r,u,f,o);else if(e){console.log("wwwwwww");var s="",h="",k="";$("#"+t).length!=0&&(s=$("#"+t).find(".info .title").text(),h=$("#"+t).find(".info .candidate-uni").text(),k=$("#"+t).find(".info .candidate-level").text());c='<div class="contact-profile"> <ul> <li> <div class="row"> <div class="col-md-7 col-6 d-flex px-0 px-md-3"> <div class="col-md-3 col-4 justify-content-center align-self-center" style="max-width:100px;"> <img class="dot" src="'+o+'"> <span class="contact-status online" style="top:0;margin:45px 0 0 55px;"><\/span> <\/div><div class="col-md-8 col-8 align-self-center px-0" style="padding:0;"> <h5 class="companyusername mb-1 ml-2">'+r+'<\/h5> <h5 class="companyusertitle mb-1 ml-2">'+s+'<\/h5> <h5 class="candidate-uni mb-1 ml-2">'+h+'<\/h5> <\/div><\/div> <div class="col-md-5 col-6 d-flex"> <div class="col-md-12 col-12 d-flex justify-content-end"> <button type="button"  onclick="AddChatList(this)" class="btn btn-start align-items-center justify-content-center d-flex" data-fullname="'+r+'" data-userid="'+t+'"> '+Res.Others.BtnStartConversation+' <\/button> <\/div><\/div><\/div><div class="row"> <div class="col-md-12 "> <div class="candidateinfo" style=""> <\/div><div class="row showcandidateinfo d-flex justify-content-center flex-column align-items-center"> <div class="rectangle"><\/div><div class="rectangle2"><\/div><\/div><\/div><\/li><\/ul> <\/div>';console.log(c);var v='<div class="messages"><\/div>',y='<div class="message-input"> <div class="wrap"> <input type="text" class="write_msg"   placeholder="'+Res.Others.PlaceHolderWriteSomething+'"> <button id="SendMessage"  onclick="SendMessage(this)" class="submit"><i class="fa fa-paper-plane" aria-hidden="true"><\/i><\/button> <\/div><\/div>',p=$('<div class="msg_history waiting" id='+i+">"+c+v+y+"<\/div>");$("#bekleyen .contact").each(function(){var n=$(this).removeClass("active")});$("#gorusulen .contact").each(function(){var n=$(this).removeClass("active")});$("#"+t).addClass("active");$("#mesgs").append(p);$("#"+i).length!=0&&($("#mesgs .write_msg").prop("disabled",!0),$("#SendMessage").prop("disabled",!0))}else{var g=$("#hdnUserCompanyprofilePhoto").val(),nt=$("#hdnUserCompanyName").val(),s="",h="";$("#"+t).length!=0&&(s=$("#"+t).find(".info .title").text(),h=$("#"+t).find(".info .candidate-uni").text());l="timetwo"+t;a="";canVideoCall&&(a='<button class="btn call-actions video-call"  data-call="video" title="GÃ¶rÃ¼ntÃ¼lÃ¼ arama baÅŸlat"><span>GÃ¶rÃ¼ntÃ¼lÃ¼ ara<\/span><\/button>');var c='<div class="contact-profile"> <ul> <li > <div class="row"> <div class="col-md-7 col-6 d-flex px-0 px-md-3"> <div class="col-md-3 col-4 justify-content-center align-self-center" style="max-width:100px;"> <img class="dot" src="'+o+'"> <span class="contact-status online" style="top:0;margin:45px 0 0 55px;"><\/span> <\/div><div class="col-md-8 col-8 align-self-center px-0" style="padding:0;"> <h5 class="companyusername mb-1 ml-2">'+r+'<\/h5> <h5 class="companyusertitle mb-1 ml-2">'+s+'<\/h5> <h5 class="candidate-uni mb-1 ml-2">'+h+'<\/h5> <\/div><\/div><div class="col-md-5 col-6 d-flex justify-content-end align-self-end"> <div class="col-md-12 col-12 d-flex flex-column justify-content-center"> <a class="btn-endconversation d-flex justify-content-end mr-md-0 mr-6" href="javascript:void(0);" data-cid="'+f.ID+'" data-uid="'+t+'">'+Res.Others.BtnEndConversation+'<\/a> <p class="remainingtime d-flex justify-content-end align-items-end"> '+a+'<button class="btn taketime" onclick="TakeExtraTime(this)" title="GÃ¶rÃ¼ÅŸmeye 2 dakika ekle" data-userid="'+t+'" data-cid="'+f.ID+'">'+Res.Others.BtnAddTwoMinutes+'<\/button><span class="time-text d-inline-flex position-relative align-self-center">'+Res.Others.RemainingTime+'<\/span> <span id="'+l+'" class="time d-inline-flex position-relative justify-content-end"> <span class="minutes"><\/span> <span class="seconds"><\/span> <\/span> <\/p><\/div><\/div><\/div><div class="row"> <div class="col-md-12 "> <div class="candidateinfo" style=""> <\/div><div class="row showcandidateinfo d-flex justify-content-center flex-column align-items-center"> <div class="rectangle"><\/div><div class="rectangle2"><\/div><\/div><\/div><\/li><\/ul> <\/div>',v='<div class="messages"><\/div>',d="typing_"+t,y='<div class="message-input"> <div class="wrap"> <div id="'+d+'" class="typing" data-uid="'+t+'"><\/div> <input type="text" class="write_msg" data-userid="'+t+'" placeholder="'+Res.Others.PlaceHolderWriteSomething+'"> <button data-userid="'+t+'" id="SendMessage"  onclick="SendMessage(this)" class="submit"><i class="fa fa-paper-plane" aria-hidden="true"><\/i><\/button> <\/div><\/div>',p=$('<div class="msg_history" id='+i+">"+c+'<div id="chat-content">'+v+y+"<\/div><\/div>");$("#gorusulen .contact").each(function(){var n=$(this).removeClass("active")});$("#"+t).addClass("active");$("#mesgs").append(p);console.log("conversation");console.log(f);f.Status!=0?(alert("df"),i="private_"+t,$("#"+i).length!=0&&($("#"+i).find(".contact-status.online").length>0?(console.log("unlock chat 1"),$("#mesgs .write_msg").prop("disabled",!1),$("#SendMessage").prop("disabled",!1)):(console.log("lock chat 1"),$("#mesgs .write_msg").prop("disabled",!0),$("#SendMessage").prop("disabled",!0)))):f.Status==0?$("#"+i).length!=0&&($("#"+t).find(".contact-status.online").length>0?(console.log("unlock chat 1"),$("#mesgs .write_msg").prop("disabled",!1),$("#SendMessage").prop("disabled",!1)):(console.log("lock chat 1"),$("#mesgs .write_msg").prop("disabled",!0),$("#SendMessage").prop("disabled",!0))):$("#mesgs .write_msg").focus();showList.push(i);f&&f.CandidateConnectDate>0&&setTimeout(function(){var n=new Date(Date.parse(new Date)+f.RemainingTime);console.log(n);console.log(f.FinishDateTimeTimeStamp);initializeClock(l,t,n)});addedSendButton=!0;w=parseInt($("[id$=hdnCurrentUserID]").val());b=t;n.server.RequestLastMessageForCompany(w,b,f.ID)}}function CheckWaitingUsers(){}function TakeExtraTime(n){var i=$(n).data("cid"),t=$(n).data("userid");$("#"+t).length>0&&i&&chat.server.TakeExtraTime(i).then(function(n){var u,r,i;if(console.log("TakeExtraTime response: "+n),n&&n>0){if(u="time"+t,timeintervals.length>0)for(r=timeintervals.filter(function(n){return n.userId==t}),i=0;i<r.length;i++)console.log(r[i]),clearInterval(r[i].timeObject),DeleteInterval(r[i].userId);setTimeout(function(){var t=new Date(Date.parse(new Date)+n);initializeClock(u,id,t);$(".message-input .wrap input").focus()},50);$("#"+t).click();$("#"+u).removeClass("red")}}).fail(function(n){$(".message-input .wrap input").focus();console.log("TakeExtraTime:"+n)})}function registerEvents(n){var t=$("[id$=hdnCurrentUserName]").val(),i=parseInt($("[id$=hdnCurrentUserID]").val()),r=parseInt($("[id$=hdnRoomID]").val()),u=$("[id$=hdnCompanyName]").val(),f=$("[id$=hdnCompanyID]").val(),e=$("[id$=hdnTitle]").val(),o=$("[id$=hdnProfilePhoto]").val();n.server.ConnectCompanyUser(t,i,r,u,f,e,o)}function AddWaitingUser(n,t,i,r,u,f,e,o){var c;console.log("run onNewWaitingUserConnected");var l=parseInt($("[id$=hdnCurrentUserID]").val()),s=$("#hdId").val(),h="";s==""&&i==l&&($("#hdId").val(n),s=n,$("#hdUserName").val(t));s!=n&&$("#"+n).length==0&&(e=GetProfilePhotoFromUserList(n),c="time"+n,c="time"+n,h=$('<li id="'+n+'" class="candidate contact"  data-fullname="'+t+'" data-userid="'+n+'"> <img class="profile-img user-photo" src="'+e+'" alt="avatar"> <span class="contact-status online"><\/span> <div class="info"> <div class="name mb-1">'+t+'<\/div><div class="title"> '+r+'<\/div><div class="candidate-uni"> '+u+' <\/div><div class="candidate-level"> '+o+" <\/div><\/div><div><\/div><\/li>"),$(h).click(function(){var r,n,i;console.log($(this));r=!0;r&&(n=$(this).attr("id"),$("#gorusulen .contact").each(function(){var n=$(this).removeClass("active")}),$("#bekleyen .contact").each(function(){var n=$(this).removeClass("active")}),$(this).addClass("active"),i=$(this),OpenPrivateChatWindow(chat,n,t,null,!0),i.find(".unreadMessage").text(""),i.find(".unreadMessage").hide(),GetCandidateInfo2(n,!0))}),$("#bekleyen ul").append(h),UpdateWaitingUserCount(),SetActive(!1),$("#waitingUserAudio")[0].play())}function GetCandidateInfo2(n,t){App.blockUI({target:".candidateinfo",animate:!0,overlayColor:"none"});$.ajax({url:"/Company/OnlineCareerFair/GetCandidateInfo",type:"GET",data:{candidateId:n,hasWaiting:t},success:function(i){i!=null&&($(".candidateinfo").empty().html(i),t&&$(".showcandidateinfo").trigger("click"),$("#"+n).length>0&&console.log("1111111"));App.unblockUI({target:".candidateinfo"})},error:function(n){App.unblockUI({target:".candidateinfo"});console.log(n.responseText+" - "+n.status)}})}function UnBlockWaiting(){setTimeout(function(){var n=$("#bekleyen");n.unblock()},1e3)}function UnBlockChatting(){setTimeout(function(){var n=$("#gorusulen");n.unblock()},1e3)}function UnBlockChattingAndWaiting(){UnBlockChatting();UnBlockWaiting()}function AddChatList(n){$("#bekleyen").block(blockOptions);$("#gorusulen").block(blockOptions);console.log("Running AddChatList");var t=$(n).data("userid"),i=$(n).data("fullname"),r=parseInt($("[id$=hdnCurrentUserID]").val());$(n).prop("disabled",!0);chat.server.CountOfActiveConversation(r).then(function(u){if(u&&u>=3)toastr.info(Res.Others.MaxChatCountSameTimeMessage),UnBlockChattingAndWaiting(),$(n).prop("disabled",!1);else{var f=$("#gorusulen ul li").length;f>=3?(toastr.info(Res.Others.MaxChatCountSameTimeMessage),UnBlockChattingAndWaiting(),$(n).prop("disabled",!1)):chat.server.AddChatList(t).then(function(u){u==1?(RemoveUserFromWaitingList(t),chat.server.GetChattingUsers(r).then(function(n){console.log(n);$.each(n,function(n,t){AddUser(chat,t.UserID,t.UserName,t.UserID,t.UniName,t.UniProgram,t.UniClass,t.ProfilePhoto,t.Level,t.Conversastion,!1,!1)});UnBlockChattingAndWaiting()}).fail(function(){UnBlockChattingAndWaiting()}),toastr.success(i+Res.Others.Connecting)):(toastr.warning(i+Res.Others.NotConnectedToChat),UnBlockChattingAndWaiting());$(n).prop("disabled",!1)}).fail(function(t){UnBlockChattingAndWaiting();console.log("AddChatList error:"+t);$(n).prop("disabled",!1)})}})}function GetConversation(n){var t,i=!1;return chat.server.GetConversation(n).done(function(n){console.log("GetConversation");console.log(n);i=!0;t=n}),console.log("GetConversation2"),console.log(t),t}function AddUser(n,t,i,r,u,f,e,o,s,h,c,l){var p,a;console.log("Add user");var b=parseInt($("[id$=hdnCurrentUserID]").val()),v=$("#hdId").val(),y="";if(v==""&&r==b&&($("#hdId").val(t),v=t,$("#hdUserName").val(i)),p="time"+t,v!=t)if($("#"+t).length==0){o=GetProfilePhotoFromUserList(t);var k='<span data-cid="'+h.ID+'" data-uid="'+r+'" id="'+p+'" class="time"><span class="minutes"><\/span><span class="seconds"><\/span><\/span>',d="expired_"+t,g='<span data-cid="'+h.ID+'" data-uid="'+r+'" id="'+d+'" class="expired">'+Res.Others.TimesUp+"<\/span><\/span>",w="";l&&(w="online");y=$('<li  id="'+t+'" data-conversationid="'+h.ID+'" class="candidate contact"> <img class="profile-img user-photo" src="'+o+'" alt="avatar"> <span class="contact-status '+w+'"><\/span> <div class="info"> <div class="name mb-1">'+i+'<\/div><div class="title">'+u+'<\/div><div class="candidate-uni">'+f+'<\/div><div class="candidate-level">'+s+"<\/div><\/div><div> "+k+g+' <span class="unreadMessage" style="display:none;"><\/span> <\/div><\/li>');$(y).click(function(){var t,r;!0&&(console.log($(this)),t=$(this).attr("id"),$("#gorusulen .contact").each(function(){var n=$(this).removeClass("active")}),$(this).addClass("active"),v!=t&&(chattingUserID=t,console.log("currentConversation"),conversationId=h.ID,r=$(this),chatting=!0,n.server.GetConversation(conversationId).then(function(u){console.log("unblocked");$(".chat-buttons").css("display","block");OpenPrivateChatWindow(n,t,i,u,!1);r.find(".unreadMessage").text("");r.find(".unreadMessage").hide();GetCandidateInfo2(t,!1)})))});a="private_"+t;$("#"+a).length>0&&(console.log("x5"),$("#"+a).hasClass("waiting")&&(console.log("x6"),setTimeout(function(){$("#"+t).trigger("click")})))}else $("#"+t).length!=0&&($("#"+t).find(".contact-status").addClass("online"),$(".write_msg").length>0&&$(".write_msg").val().length===0&&$("#"+t).click()),a="private_"+t,$("#"+a).length!=0&&(console.log("unlock chat 1"),$("#mesgs .write_msg").prop("disabled",!1),$("#SendMessage").prop("disabled",!1));console.log(y);$("#gorusulen ul").append(y);UpdateChattingUserCount();SetActive(!0);h&&h.CandidateConnectDate>0&&setTimeout(function(){var n=new Date(Date.parse(new Date)+h.RemainingTime);initializeClock(p,t,n)},100);$("#mesgs").find(".msg_history").hasClass("msg_history")||c&&$("#"+t).trigger("click")}function ResetTypingFlag(){TypingFlag=!0}function RemoveChatContent(){console.log("RemoveChatContent");$("#mesgs").empty();setTimeout(function(){$("#mesgs").addClass("chat-bg")},200);$(".user-info").empty();$(".chat-buttons").css("display","none")}function getTimeRemaining(n){var t=Date.parse(n)-Date.parse(new Date),i=Math.floor(t/1e3%60),r=Math.floor(t/6e4%60),u=Math.floor(t/36e5%24),f=Math.floor(t/864e5);return{total:t,days:f,hours:u,minutes:r,seconds:i}}function initializeClock(n,t,i){var r=document.getElementById(n),f;if(r!=null){var e=r.querySelector(".minutes"),o=r.querySelector(".seconds"),u=$("#"+n).data("cid"),t=$("#"+n).data("uid");console.log("cccc:"+u);function s(){var r=getTimeRemaining(i);e.innerHTML=("0"+r.minutes).slice(-2)+":";o.innerHTML=("0"+r.seconds).slice(-2);r.minutes==0&&e.parentNode.classList.add("red");r.total<=0&&(clearInterval(f),u&&n.indexOf("two")==-1&&(console.log("chat time expired"),typeof app=="undefined"||_.isEmpty(app.currentSession)||(app.currentSession.stop({}),app.currentSession={},$("#video-content").remove(),$(".btn.call-actions.video-call").show(),$("#onvideocall").modal("hide"),$(".btn-end-call").hide()),EndConversation(u,t,!0)))}s();f=setInterval(s,1e3);n.indexOf("two")==-1&&(console.log("timeintervals"),timeintervals.push({timeId:n,userId:t,timeObject:f}),console.log(timeintervals))}}function scroll(n,t,i){this.stop().animate({scrollTop:n},i,function(){var i=n?"top":"bottom";$(t).html("scroll to "+i).attr({id:i})})}function ScrollToMessages(n){if($(".messages").length>0){height=0;var t=$(".messages");console.log(height);height<t[0].scrollHeight?(console.log("scroll 1"),height=t[0].scrollHeight):(console.log("scroll 2"),height=0);scroll.call(t,height,this,n)}else console.log("messages class not found")}function BlockElementMessage(){var n=$(".right-sidebar .user-info");n.block({message:'<center><img src="/Areas/Admin/Content/layouts/layout2/img/loading-spinner-default.gif" align="center"><\/center>',target:".right-sidebar",css:{border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:"#555",opacity:.1,cursor:"wait"}})}var chat,chatting=!1,conversationId=0,chattingUserID=0,height=0,chatSignalrUrl,finishedConversationQueue=[],timeintervals=[],blockhtml='<div class="loading-message"><div class="block-spinner-bar"><div class="bounce1"><\/div><div class="bounce2"><\/div><div class="bounce3"><\/div><\/div><\/div>',canVideoCall=!1,blockOptions={message:blockhtml,baseZ:1e3,centerY:!0,css:{top:"10%",border:"0",padding:"0",backgroundColor:"transparent"},overlayCSS:{backgroundColor:"transparent",cursor:"wait"}},browserState,waitingUserCount,chattingUserCount,TypingFlag;window.addEventListener("focus",handleBrowserState.bind(document,!0));window.addEventListener("blur",handleBrowserState.bind(document,!1));browserState=!0;$(document).ready(function(){document.getElementById("canVideoCall").value=="true"&&(canVideoCall=!0);$(".sidebar-toggler").click();$("#mesgs").on("click",".showcandidateinfo",function(){$(".contact-profile").toggleClass("show");$(this).find("div").removeClass("rectangle2").removeClass("rectangle");$(".contact-profile.show").length>0?($(this).find("div:first").addClass("rectangle2"),$(this).find("div:nth-child(2)").addClass("rectangle")):($(this).find("div:first").addClass("rectangle"),$(this).find("div:nth-child(2)").addClass("rectangle2"));console.log("105100")});setInterval(ResetTypingFlag,3e3);chatSignalrUrl=document.getElementById("chatSignalrUrl").value;$.connection.hub.url=chatSignalrUrl+"/signalr";chat=$.connection.chatHub;$.connection.hub.logging=!0;chat.state.networkingID=$("#Networking_NetworkingID").val();chat.state.networkingUrlValue=$("#Networking_UrlValue").val();registerClientMethods(chat);console.log("Start Hub");$.connection.hub.start().done(function(){console.log("Now connected, connection ID="+$.connection.hub.id);console.log("Connected, transport = "+$.connection.hub.transport.name);registerEvents(chat);toastr.success(Res.Others.ConnectedMessage)}).fail(function(n){console.log("Invocation of ChatMessage failed. Error: "+n)});$.connection.hub.disconnected(function(){$("#profile span.contact-status").removeClass("online");setTimeout(function(){$.connection.hub.start().done(function(){console.log("Now reconnected, connection ID="+$.connection.hub.id);console.log("ReConnected, transport = "+$.connection.hub.transport.name);registerEvents(chat)}).fail(function(n){console.log("Invocation of ChatMessage failed. Error: "+n)})},3e3)});chat.client.ReceiveTypingRequest=function(n,t){var i="private_"+n;$("#"+i).length>0&&($("#typing_"+n).html(t+Res.Others.Typing).show(),$("#typing_"+n).delay(3e3).fadeOut("slow"))};chat.client.SendNotification=function(n){toastr.info(n)};chat.client.RemoveUserWaitingList=function(n){console.log("RemoveUserWaitingList");RemoveUserFromWaitingList(n);var t="private_"+n;$("#"+t).length>0&&RemoveChatContent()};chat.client.EndThisConversation=function(n){var r,u,i,t;if(console.log("started EndThisConversation"),n){if(r="private_"+n.UserID,$("#"+n.UserID).length>0&&($("#"+n.UserID).addClass("endeduser"),u="time"+n.UserID,$("#"+u).hide(),timeintervals.length>0))for(i=timeintervals.filter(function(t){return t.userId==n.UserID}),t=0;t<i.length;t++)clearInterval(i[t].timeObject),DeleteInterval(i[t].userId);$("#"+r).length>0&&$("#"+n.UserID).trigger("click")}};chat.client.GetLastMessages=function(n,t,r){var l=$(".messages"),o="private_"+n,f="",s,e,c,h,u;for(f+="<ul>",r&&r.CandidateConnectDate>0?(s=GetTimeFromDateTime(r.CandidateConnectDate),e="",$("#"+o).length>0&&(e=$("#"+o).find(".companyusername").text()),f+='<li class="connectedtime">  <p>'+e+Res.Others.SomeoneConnectedToChat+"<span>"+s+"<\/span><\/p><\/li>"):(s=GetTimeFromDateTime(r.CandidateConnectDate),e="",$("#"+o).length>0&&(e=$("#"+o).find(".companyusername").text()),f+='<li class="connectedtime red">  <p>'+e+Res.Others.SomeoneNotConnectedToChat+"<\/p><\/li>"),c=$("#hdnProfilePhoto").val(),h="",i=0;i<t.length;i++)u=t[i],u.MessageType==1?f+='<li class="connectedtime">  <p>'+Res.Others.AddedToChatTwoMinutes+"<span>"+GetTimeFromDateTime(u.DateTime)+"<\/span><\/p><\/li>":n==u.ToUserID?f+='<li class="sent">  <p>'+u.Message+"<span>"+GetTimeFromDateTime(u.DateTime)+"<\/span><\/p><\/li>":(console.log(u),h=GetProfilePhotoFromUserList(u.FromUserID),f+='<li class="replies"> <p>'+u.Message+"<span>"+GetTimeFromDateTime(u.DateTime)+"<\/span><\/p><\/li>");console.log(f);f+="<\/ul>";$("#"+o).find(".messages").append(f);console.log("scroll started");ScrollToMessages(0)};chat.client.onNewUserConnected=function(n,t,i,r,u,f,e,o,s){console.log("onNewUserConnected");console.log(s);AddUser(chat,n,t,n,r,u,f,e,o,s,!0,!0)};chat.client.onNewWaitingUserConnected=function(n,t,i,r,u,f,e,o){AddWaitingUser(n,t,n,r,u,f,e,o)};chat.client.onUserDisconnected=function(n){console.log("Runing onUserDisconnected");$("#"+n).length!=0&&$("#"+n).find(".contact-status").removeClass("online");var t="private_"+n;$("#"+t).length!=0&&(console.log("lock chat 2"),$("#mesgs .write_msg").prop("disabled",!0),$("#SendMessage").prop("disabled",!0))};chat.client.sendPrivateMessage=function(n,t,i,r,u,f,e){var v,o,c,h,l,s,y,a;TypingFlag=!0;console.log(u);console.log("dd");console.log("Runing sendPrivateMessage");v=$("#hdnCurrentUserID").val();o="private_"+n;$("#"+o).length==0?chatting==!1?(createPrivateChatWindow(chat,n,o,t,i,e,!0),chatting=!0):$("#"+n).hasClass("active")==!1&&(c=$("#"+n).find(".unreadMessage"),h=c.text(),h===""?$("#"+n).find(".unreadMessage").text(1):(l=parseInt(h)+1,$("#"+n).find(".unreadMessage").text(l)),$("#"+n).find(".unreadMessage").show(),$("#chatAudio")[0].play(),$("#"+n).effect("shake",{times:2},1e3)):(s="",y=$("#hdnProfilePhoto").val(),f?s+='<li class="sent">  <p>'+r+"<span>"+GetTimeFromDateTime(u)+"<\/span><\/p><\/li>":(a="",a=GetProfilePhotoFromUserList(n),s+='<li class="replies"> <p>'+r+"<span>"+GetTimeFromDateTime(u)+"<\/span><\/p><\/li>"),$("#"+o).find(".messages ul").append(s),ScrollToMessages(0));browserState||$("#chatAudio")[0].play()};$("#mesgs").on("keydown",".write_msg",function(n){n.keyCode===13&&$("#SendMessage").trigger("click");SetBlueToChatButton(this)});$("#mesgs ").on("keyup",".write_msg",function(){SetBlueToChatButton(this);var n=$(this).data("userid");TypingFlag==!0&&chat.server.SendCandidateTypingRequest(n);TypingFlag=!1});$("#mesgs").on("blur",".write_msg",function(){SetBlueToChatButton(this)})});waitingUserCount=0;chattingUserCount=0;var showList=[],addedSendButton=!1,profilePhotos=[];TypingFlag=!0;